<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Adjudicaci√≥n de Plazas ‚Äì UGEL Cusco</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg:        #f0f4ff;
      --surface:   #ffffff;
      --surface2:  #f8faff;
      --azul:      #1e3a8a;
      --azul-mid:  #1d4ed8;
      --azul-vivo: #2563eb;
      --rojo:      #dc2626;
      --rojo-bg:   #fff5f5;
      --verde:     #16a34a;
      --verde-bg:  #f0fdf4;
      --texto:     #1e293b;
      --texto-dim: #64748b;
      --borde:     #e2e8f0;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--texto);
      min-height: 100vh;
      padding-bottom: 62px;
    }

    /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
    header {
      background: linear-gradient(135deg, var(--azul) 0%, var(--azul-mid) 100%);
      padding: 14px 20px;
      display: flex; align-items: center; gap: 14px;
      position: sticky; top: 0; z-index: 90;
      box-shadow: 0 2px 10px rgba(30,58,138,0.3);
    }
    header img { height: 56px; flex-shrink: 0; }
    .header-text h2 {
      font-family: 'Montserrat', sans-serif;
      font-size: 0.62rem; font-weight: 700;
      color: #93c5fd; letter-spacing: 0.1em; text-transform: uppercase;
      display: none; /* oculto en m√≥vil, visible en desktop */
    }
    .header-text h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: clamp(0.82rem, 2.2vw, 1.4rem);
      font-weight: 900; color: #fff; line-height: 1.2;
    }
    .live-badge {
      display: inline-flex; align-items: center; gap: 5px;
      font-size: 0.62rem; color: #fca5a5; font-weight: 700;
      letter-spacing: 0.05em; margin-top: 3px;
    }
    .pulse {
      width: 6px; height: 6px; background: #ef4444;
      border-radius: 50%; flex-shrink: 0;
      animation: pulse 1.5s ease infinite;
    }
    @keyframes pulse {
      0%,100% { transform: scale(1); opacity: 1; }
      50%      { transform: scale(1.8); opacity: 0.35; }
    }

    /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
    main { max-width: 1500px; margin: 0 auto; padding: 14px 10px; }

    /* ‚îÄ‚îÄ‚îÄ FILTROS ‚îÄ‚îÄ‚îÄ */
    .filters-section {
      background: var(--surface); border: 1px solid var(--borde);
      border-radius: 10px; padding: 14px 16px; margin-bottom: 12px;
      box-shadow: 0 1px 4px rgba(30,58,138,0.06);
    }
    .filters-title {
      font-size: 0.82rem; font-weight: 700; color: var(--texto);
      margin-bottom: 10px;
    }
    .filters-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;   /* 2 columnas en m√≥vil */
      gap: 8px;
    }
    .filters-grid .full { grid-column: 1 / -1; }  /* b√∫squeda texto: ancho completo */

    label {
      font-size: 0.68rem; color: var(--texto-dim);
      margin-bottom: 3px; display: block; font-weight: 600;
      text-transform: uppercase; letter-spacing: .04em;
    }
    select, input[type="text"] {
      width: 100%; padding: 8px 10px;
      background: var(--surface2); border: 1.5px solid var(--borde);
      border-radius: 7px; color: var(--texto);
      font-size: 0.8rem; font-family: 'Inter', sans-serif;
      outline: none; transition: border-color .2s, box-shadow .2s;
    }
    select:focus, input[type="text"]:focus {
      border-color: var(--azul-vivo);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.12);
    }

    /* ‚îÄ‚îÄ‚îÄ INFO BAR ‚îÄ‚îÄ‚îÄ */
    .info-bar {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 6px; flex-wrap: wrap; gap: 4px;
    }
    .result-count { font-size: 0.72rem; color: var(--texto-dim); }
    .result-count strong { color: var(--azul); }
    .last-update { font-size: 0.67rem; color: var(--texto-dim); }
    .last-update span { color: var(--azul-vivo); font-weight: 600; }

    /* ‚îÄ‚îÄ‚îÄ TABLA ‚îÄ‚îÄ‚îÄ */
    .table-wrapper {
      background: var(--surface); border: 1px solid var(--borde);
      border-radius: 10px; overflow: hidden;
      box-shadow: 0 1px 4px rgba(30,58,138,0.07);
    }
    .table-scroll {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 65vh;
      -webkit-overflow-scrolling: touch;
    }
    /* scrollbar delgado */
    .table-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
    .table-scroll::-webkit-scrollbar-track { background: var(--surface2); }
    .table-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }

    table {
      width: max-content;
      min-width: 100%;
      border-collapse: collapse;
    }
    thead { position: sticky; top: 0; z-index: 5; }
    thead th {
      background: var(--azul); color: #fff;
      font-family: 'Inter', sans-serif;
      font-size: 0.62rem; font-weight: 700;
      text-transform: uppercase; letter-spacing: .07em;
      padding: 9px 10px; text-align: left;
      white-space: nowrap;
      border-right: 1px solid rgba(255,255,255,0.1);
    }
    thead th:last-child { border-right: none; }

    tbody tr { border-bottom: 1px solid var(--borde); transition: background .1s; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: #eff6ff; }
    tbody td {
      padding: 7px 10px; vertical-align: middle;
      font-size: 0.75rem; color: var(--texto);
      white-space: nowrap;
    }

    tr.disponible { background: var(--verde-bg); }
    tr.disponible:hover { background: #dcfce7; }
    tr.adjudicada { background: var(--rojo-bg); }
    tr.adjudicada:hover { background: #fee2e2; }

    .badge {
      display: inline-block; padding: 2px 8px; border-radius: 20px;
      font-size: 0.62rem; font-weight: 700; white-space: nowrap;
    }
    .badge-disponible { background: #dcfce7; color: #15803d; border: 1px solid #86efac; }
    .badge-adjudicada { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }
    .badge-default    { background: var(--surface2); color: var(--texto-dim); }

    /* aviso scroll solo en m√≥vil */
    .scroll-hint {
      text-align: center; font-size: 0.65rem; color: var(--texto-dim);
      padding: 6px; background: var(--surface2);
      border-top: 1px solid var(--borde);
      display: none;
    }

    /* ‚îÄ‚îÄ‚îÄ CARGA / ERROR ‚îÄ‚îÄ‚îÄ */
    #estado-carga { text-align: center; padding: 50px 20px; }
    .spinner {
      width: 34px; height: 34px;
      border: 3px solid var(--borde); border-top-color: var(--azul-vivo);
      border-radius: 50%; animation: spin .8s linear infinite;
      margin: 0 auto 12px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .error-box {
      background: #fef2f2; border: 1px solid #fca5a5;
      border-radius: 8px; padding: 14px 18px; color: #b91c1c; font-size: .82rem;
    }

    /* ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ */
    footer {
      position: fixed; bottom: 0; left: 0; width: 100%;
      background: var(--azul); color: rgba(255,255,255,0.8);
      text-align: center; font-size: 0.62rem; padding: 6px; z-index: 80;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ‚îÄ DESKTOP ‚îÄ‚îÄ‚îÄ */
    @media (min-width: 640px) {
      header { padding: 16px 28px; gap: 18px; }
      header img { height: 64px; }
      .header-text h2 { display: block; }
      main { padding: 18px 16px; }
      .filters-grid {
        grid-template-columns: repeat(4, 1fr);  /* 4 columnas en desktop */
      }
      .filters-grid .full { grid-column: auto; } /* texto: 1 columna normal */
    }

    /* ‚îÄ‚îÄ‚îÄ M√ìVIL ‚îÄ‚îÄ‚îÄ */
    @media (max-width: 639px) {
      .scroll-hint { display: block; }
    }
  </style>
</head>
<body>

<header>
  <img src="https://ugelcusco.gob.pe/ws/wp-content/uploads/2026/02/LOGOOOO.fw_.png" alt="UGEL Cusco" onerror="this.style.display='none'"/>
  <div class="header-text">
    <h2>Unidad de Gesti√≥n Educativa Local Cusco</h2>
    <h1>Adjudicaci√≥n de Plazas ‚Äî Contrato Docente</h1>
    <div class="live-badge">
      <span class="pulse"></span>
      ‚óè ACTUALIZACI√ìN EN VIVO (CADA 5s)
    </div>
  </div>
</header>

<main>

  <!-- FILTROS -->
  <div class="filters-section">
    <div class="filters-title">üîç B√∫squeda Avanzada</div>
    <div class="filters-grid">
      <div>
        <label for="f-nivel">Nivel Educativo</label>
        <select id="f-nivel"><option value="">TODOS</option></select>
      </div>
      <div>
        <label for="f-cargo">Cargo</label>
        <select id="f-cargo"><option value="">TODOS</option></select>
      </div>
      <div>
        <label for="f-estado">Estado</label>
        <select id="f-estado">
          <option value="">TODOS</option>
          <option value="DISPONIBLE">DISPONIBLE</option>
          <option value="ADJUDICADA">ADJUDICADA</option>
        </select>
      </div>
      <div class="full">
        <label for="f-busca">Buscar por IE / Especialidad</label>
        <input type="text" id="f-busca" placeholder="Escriba aqu√≠..."/>
      </div>
    </div>
  </div>

  <!-- INFO -->
  <div class="info-bar">
    <div class="result-count" id="result-count"></div>
    <div class="last-update">Actualizado: <span id="last-time">‚Äî</span></div>
  </div>

  <!-- TABLA -->
  <div class="table-wrapper">
    <div id="estado-carga">
      <div class="spinner"></div>
      <p style="color:var(--texto-dim);font-size:.82rem">Cargando datos‚Ä¶</p>
    </div>
    <div class="table-scroll" id="table-container" style="display:none">
      <table>
        <thead id="table-head"></thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <div class="scroll-hint">‚Üê Desliza para ver m√°s columnas ‚Üí</div>
  </div>

</main>

<footer>
  ¬© 2026 Equipo de Inform√°tica ‚Äì UGEL Cusco &nbsp;|&nbsp;
  Tablero meramente informativo. La adjudicaci√≥n oficial se realiza en acto p√∫blico.
</footer>

<script>
  const SHEET_ID   = "1E1bGvrOn6vmYZxIlRYZfqdQ8DiYXJBtH";
  const REFRESH_MS = 5_000;

  let allData = [], headers = [];
  let colEstado = -1, colNivel = -1, colCargo = -1;

  async function fetchData() {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&t=${Date.now()}`;
    const resp = await fetch(url);
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    return parseCSV(await resp.text());
  }

  function parseCSV(text) {
    const parse = line => {
      const out = []; let cur = ""; let q = false;
      for (const ch of line) {
        if (ch === '"') { q = !q; }
        else if (ch === ',' && !q) { out.push(cur.trim()); cur = ""; }
        else cur += ch;
      }
      out.push(cur.trim());
      return out;
    };
    const lines = text.trim().split("\n");
    return { headers: parse(lines[0]), rows: lines.slice(1).map(parse) };
  }

  function findCol(name) {
    return headers.findIndex(h => h.toUpperCase().includes(name));
  }

  function populateSelect(id, colIdx) {
    const sel = document.getElementById(id);
    const cur = sel.value;
    const vals = [...new Set(allData.map(r => r[colIdx]).filter(Boolean))].sort();
    sel.innerHTML = '<option value="">TODOS</option>';
    vals.forEach(v => {
      const o = document.createElement("option");
      o.value = o.textContent = v;
      sel.appendChild(o);
    });
    sel.value = cur;
  }

  function applyFilters() {
    const nivel  = document.getElementById("f-nivel").value.toLowerCase();
    const cargo  = document.getElementById("f-cargo").value.toLowerCase();
    const estado = document.getElementById("f-estado").value.toUpperCase();
    const busca  = document.getElementById("f-busca").value.toLowerCase();

    const filtered = allData.filter(row => {
      if (nivel  && colNivel  >= 0 && (row[colNivel]  || "").toLowerCase() !== nivel)  return false;
      if (cargo  && colCargo  >= 0 && (row[colCargo]  || "").toLowerCase() !== cargo)  return false;
      if (estado && colEstado >= 0 && (row[colEstado] || "").trim().toUpperCase() !== estado) return false;
      if (busca  && !row.some(c => (c || "").toLowerCase().includes(busca))) return false;
      return true;
    });

    renderTable(filtered);

    const total = allData.length;
    document.getElementById("result-count").innerHTML =
      `Mostrando <strong>${filtered.length}</strong> de <strong>${total}</strong> plazas`;
  }

  function renderTable(filtered) {
    const thead = document.getElementById("table-head");
    const tbody = document.getElementById("table-body");

    if (!thead.innerHTML)
      thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";

    if (!filtered.length) {
      tbody.innerHTML = `<tr><td colspan="${headers.length}"
        style="text-align:center;padding:36px;color:var(--texto-dim);white-space:normal;font-size:.8rem">
        No se encontraron plazas con los filtros seleccionados.</td></tr>`;
      return;
    }

    tbody.innerHTML = filtered.map(row => {
      const est = colEstado >= 0 ? (row[colEstado] || "").trim().toUpperCase() : "";
      const cls = est === "ADJUDICADA" ? "adjudicada" : est === "DISPONIBLE" ? "disponible" : "";
      const cells = row.map((cell, i) => {
        if (i === colEstado) {
          const bc = est === "DISPONIBLE" ? "badge-disponible"
                   : est === "ADJUDICADA" ? "badge-adjudicada" : "badge-default";
          return `<td><span class="badge ${bc}">${cell || "‚Äî"}</span></td>`;
        }
        return `<td>${cell !== undefined && cell !== "" ? cell : "‚Äî"}</td>`;
      }).join("");
      return `<tr class="${cls}">${cells}</tr>`;
    }).join("");
  }

  async function refresh() {
    try {
      const { headers: hdrs, rows } = await fetchData();
      const first = headers.length === 0;
      headers = hdrs; allData = rows;
      colEstado = findCol("ESTADO");
      colNivel  = findCol("NIVEL");
      colCargo  = findCol("CARGO");

      if (colNivel >= 0) populateSelect("f-nivel", colNivel);
      if (colCargo >= 0) populateSelect("f-cargo", colCargo);

      if (first) {
        document.getElementById("estado-carga").style.display    = "none";
        document.getElementById("table-container").style.display = "block";
        ["f-nivel","f-cargo","f-estado","f-busca"].forEach(id =>
          document.getElementById(id).addEventListener("input", applyFilters));
      }

      applyFilters();
      document.getElementById("last-time").textContent =
        new Date().toLocaleTimeString("es-PE", {hour:"2-digit", minute:"2-digit", second:"2-digit"});

    } catch (err) {
      if (!allData.length)
        document.getElementById("estado-carga").innerHTML =
          `<div class="error-box">‚ùå Error: ${err.message}<br/>
           <small>Verifica que la hoja sea p√∫blica (Compartir ‚Üí Cualquier persona con el enlace).</small></div>`;
      console.error(err);
    }
  }

  refresh();
  setInterval(refresh, REFRESH_MS);
</script>
</body>
</html>
